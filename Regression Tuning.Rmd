---
title: "Delhi Hedonic Regression"
author: "Michael Murray"
date: "November 3, 2015"
output: html_document
---
```{r}
setwd("~/Spatial Segmentation/India")
write.csv(delhi, "delhi.csv")
delhi <- read.csv("delhi.csv")

library(GGally)
```

### Use left-most column to identify candidates for log transformation
```{r}
pairs(hp ~ rooms + property + CBD, data = delhi)

pairs(hp ~ bar + cemetery + golf, data = delhi)

pairs(hp ~ industrial + parking + petrol, data = delhi)

pairs(hp ~ tourist + amusement + bus, data = delhi)

pairs(hp ~ community + highered + library, data = delhi)

pairs(hp ~ parkinglot + train + police, data = delhi)

pairs(hp ~ animal + business + commuterrail, data = delhi)

pairs(hp ~ hospital + performingarts + school + park, data = delhi)
```

### Initial Regression
```{r}
delhi.lm.poi <- lm(hp ~ rooms + property + CBD +
                     airport + bar + cemetery + golf + industrial +
                     parking + petrol + tourist + amusement + bus +
                     community + highered + library + parkinglot +
                     train + police + animal + business + commuterrail +
                     hospital + performingarts + school + park, data = delhi)

summary(delhi.lm.poi)

par(mfrow = c(2,2))
plot(delhi.lm.poi)
```

### Added CBDs
```{r}
delhi.lm.poi <- lm(hp ~ rooms + property + CBD + CBD2 + CBD3 +
                     airport + bar + cemetery + golf + industrial +
                     parking + petrol + tourist + amusement + bus +
                     community + highered + library + parkinglot +
                     train + police + animal + business + commuterrail +
                     hospital + performingarts + school + park, data = delhi)

summary(delhi.lm.poi)

par(mfrow = c(2,2))
plot(delhi.lm.poi)

```

### Tried removing insignificant POI, does not improve model
#### Bus, Library, Business

```{r}
delhi.lm.poi2 <- lm(hp ~ rooms + property + CBD + CBD2 + CBD3 +
                     airport + bar + cemetery + golf + industrial +
                     parking + petrol + tourist + amusement +
                     community + highered + parkinglot +
                     train + police + animal + commuterrail +
                     hospital + performingarts + school + park, data = delhi)

summary(delhi.lm.poi2)

par(mfrow = c(2,2))
plot(delhi.lm.poi)

anova(delhi.lm.poi,delhi.lm.poi2)

```

### Log-Lin (best so far)
```{r}
delhi.lm.poi3 <- lm(log(hp) ~ rooms + property + CBD + CBD2 + CBD3 +
                     airport + bar + cemetery + golf + industrial +
                     parking + petrol + tourist + amusement + bus +
                     community + highered + library + parkinglot +
                     train + police + animal + business + commuterrail +
                     hospital + performingarts + school + park, data = delhi)

summary(delhi.lm.poi3)

```

### Pull out amusement
```{r}
delhi.lm.poi4 <- lm(log(hp) ~ rooms + property + CBD + CBD2 + CBD3 +
                     airport + bar + cemetery + golf + industrial +
                     parking + petrol + tourist + bus +
                     community + highered + library + parkinglot +
                     train + police + animal + business + commuterrail +
                     hospital + performingarts + school + park, data = delhi)

anova(delhi.lm.poi3,delhi.lm.poi4)
```

### Pull out hospital

```{r}
delhi.lm.poi5 <- lm(log(hp) ~ rooms + property + CBD + CBD2 + CBD3 +
                     airport + bar + cemetery + golf + industrial +
                     parking + petrol + tourist + bus +
                     community + highered + library + parkinglot + amusement +
                     train + police + animal + business + commuterrail + performingarts + school + park, data = delhi)

anova(delhi.lm.poi3,delhi.lm.poi5)
```

### Identify possible outliers
```{r}
par(mfrow = c(2,2))
plot(delhi.lm.poi3)
```

#### Make new datasets to test outliers
```{r}
delhi2 <- delhi[-280,]
delhi3 <- delhi[-35737,]
delhi4 <- delhi[-35735,]
```

#### Test new datasets
```{r}
delhi.lm.poi6 <- lm(log(hp) ~ rooms + property + CBD + CBD2 + CBD3 +
                     airport + bar + cemetery + golf + industrial +
                     parking + petrol + tourist + amusement + bus +
                     community + highered + library + parkinglot +
                     train + police + animal + business + commuterrail +
                     hospital + performingarts + school + park, data = delhi2)

delhi.lm.poi7 <- lm(log(hp) ~ rooms + property + CBD + CBD2 + CBD3 +
                     airport + bar + cemetery + golf + industrial +
                     parking + petrol + tourist + amusement + bus +
                     community + highered + library + parkinglot +
                     train + police + animal + business + commuterrail +
                     hospital + performingarts + school + park, data = delhi3)

delhi.lm.poi8 <- lm(log(hp) ~ rooms + property + CBD + CBD2 + CBD3 +
                     airport + bar + cemetery + golf + industrial +
                     parking + petrol + tourist + amusement + bus +
                     community + highered + library + parkinglot +
                     train + police + animal + business + commuterrail +
                     hospital + performingarts + school + park, data = delhi4)

summary(delhi.lm.poi6)
summary(delhi.lm.poi7)
summary(delhi.lm.poi8)

```

### Test with all three outliers removed (Best 11.5.15)
```{r}
delhi5 <- delhi2[-35737,]
delhi5 <- delhi5[-35735,]

delhi.lm.poi9 <- lm(log(hp) ~ rooms + property + CBD + CBD2 + CBD3 +
                     airport + bar + cemetery + golf + industrial +
                     parking + petrol + tourist + amusement + bus +
                     community + highered + library + parkinglot +
                     train + police + animal + business + commuterrail +
                     hospital + performingarts + school + park, data = delhi5)

summary(delhi.lm.poi9)
```

### Regression with only structure

```{r}

delhi.lm.poi10 <- lm(log(hp) ~ rooms + property + CBD + CBD2 + CBD3, data = delhi5)

summary(delhi.lm.poi10)

```






